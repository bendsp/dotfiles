#!/bin/bash

# Usage: ocp "Your prompt here"
# Captures the content of the LAST active tmux pane and feeds it to opencode as context.

# 1. Get the ID of the last active pane (the one you were just in)
LAST_PANE=$(tmux display-message -p -t "{last}" "#{pane_id}")

# 2. Capture the content (history) of that pane
# -p = print to stdout
# -t = target pane
# -S -2000 = start 2000 lines back
# -J = Join wrapped lines (makes logs easier to read)
CONTEXT=$(tmux capture-pane -p -t "$LAST_PANE" -S -2000 -J)

# 3. Construct the prompt
if [ -z "$1" ]; then
    USER_PROMPT="Here is the context from my active pane. Please analyze it."
else
    USER_PROMPT="$@"
fi

FULL_PROMPT="$USER_PROMPT

--- PANE OUTPUT ---
$CONTEXT
--- END OUTPUT ---"

# 4. Run opencode
opencode "$FULL_PROMPT"
