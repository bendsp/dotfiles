#!/bin/bash

# Usage: ocp "Your prompt here"
# Captures the content of the LAST active tmux pane and feeds it to opencode as context.

# 1. Get the ID of the last active pane (the one you were just in)
LAST_PANE=$(tmux display-message -p -t "{last}" "#{pane_id}")

# 2. Capture the content (history) of that pane
# -p = print to stdout
# -t = target pane
# -S -2000 = start 2000 lines back
CONTEXT=$(tmux capture-pane -p -t "$LAST_PANE" -S -2000)

# 3. Construct the prompt
USER_PROMPT="$@"
FULL_PROMPT="I am sending you the output from my other tmux pane. Please use it as context to answer my question.\n\n--- PANE OUTPUT ---\n$CONTEXT\n\n--- END OUTPUT ---\n\nQUESTION: $USER_PROMPT"

# 4. Run opencode with the context
# We use -c (context) if your version supports it, or just append it to the prompt.
opencode "$FULL_PROMPT"
